{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/nearest_market.css' %}" />
    <title>ê°€ì¥ ê°€ê¹Œìš´ ë§ˆì¼“</title>
  </head>
  <body>
    <div class="container">
      <div class="box">
        {% comment %} ìƒë‹¨ë°” {% endcomment %}
        <div class="status-bar">
          <p>19:20</p>
          <div class="status1">
            <img class="status2" src="{% static 'img/reception.svg' %}" alt="reception" />
            <img class="status2" src="{% static 'img/wifi.svg' %}" alt="wifi" />
            <img class="status2" src="{% static 'img/battery.svg' %}" alt="battery" />
          </div>
        </div>

        {% comment %} ì•± ìì²´ ìƒë‹¨ë°” {% endcomment %}
        <div class="app-top-bar">
          <a href="javascript:history.back()" aria-label="ë’¤ë¡œê°€ê¸°">
            <img class="top-back" src="{% static 'img/chevron-left.svg' %}" alt="ë’¤ë¡œê°€ê¸°" />
          </a>

          <div class="top-point">
            <a class="top-cart" href="{% url 'food:cart_view' %}" aria-label="ì¥ë°”êµ¬ë‹ˆ">
              ğŸ§º{% if cart_items_count %}<span class="cart-count">{{ cart_items_count }}</span>{% endif %}
            </a>
            <img class="point" src="{% static 'img/lucide.svg' %}" alt="point" />
            <p class="mypoint">{{ total_point }} P</p>
          </div>
        </div>

        <main class="app-body">
          <div class="mart-info">
            <div class="mart-title">
              <h4 class="mart-title2">{{ market.name }}</h4>
              <p class="mart-title3">{{ market.address }}</p>
              <p class="mart-dis">{{ distance_m }}m</p>
            </div>

            {% if market.image %}
              <img class="mart-pic" src="{{ market.image.url }}" alt="{{ market.name }} ì´ë¯¸ì§€" />
            {% else %}
              <img class="mart-pic" src="{% static 'img/image 1.svg' %}" alt="mart-pic" />
            {% endif %}

            <div class="circle-wrap">
              <div class="middle-line"></div>
              <div class="circle-time">
                <span class="runner-time">{{ expected_time }}ë¶„</span>
              </div>
            </div>
          </div>

          <div class="mart-due">í˜„ì¬ ìœ„ì¹˜ì—ì„œ {{ expected_time }}ë¶„ë§Œ ê±¸ì–´ê°€ë©´ ë¼ìš”!</div>

          <div class="app-bottom-bar">
            <div class="bar-content">
              <div class="bar-list">
                <div class="mart-dropdown">
                  <div class="bar-title">
                    ì—…ì²´ ì •ë³´
                    <img class="more-icon" src="{% static 'img/chevron-down.svg' %}" alt="í¼ì¹˜ê¸°" />
                  </div>

                  <div class="mart-info2">
                    <label class="mi-item">
                      <img src="{% static 'img/clock.svg' %}" alt="time" />
                      <span class="mi-name">
                        {% if closing_in_minutes > 0 %}
                          {% if closing_in_minutes <= 30 %}
                            ì˜ì—… ì¢…ë£Œê¹Œì§€ {{ closing_in_minutes }}ë¶„ ë‚¨ì•˜ì–´ìš”.
                          {% else %}
                            í˜„ì¬ ì˜ì—… ì¤‘
                          {% endif %}
                        {% else %}
                          ì˜ì—… ì¢…ë£Œ
                        {% endif %}
                      </span>
                    </label>

                    {% if market.info %}
                    <label class="mi-item">
                      <img src="{% static 'img/store.svg' %}" alt="store" />
                      <span class="mi-name">{{ market.info }}</span>
                    </label>
                    {% endif %}

                    {% if market.phone %}
                    <label class="mi-item">
                      <img src="{% static 'img/phone.svg' %}" alt="phone" />
                      <span class="mi-name">{{ market.phone }}</span>
                    </label>
                    {% endif %}

                    {% if market.address %}
                    <label class="mi-item">
                      <img src="{% static 'img/map-pin.svg' %}" alt="map" />
                      <span class="mi-name">{{ market.address }}</span>
                    </label>
                    {% endif %}
                  </div>
                </div>

                <div class="mart-dropdown">
                  <div class="bar-title">
                    ì¥ë°”êµ¬ë‹ˆ
                    <img class="more-icon" src="{% static 'img/chevron-down.svg' %}" alt="í¼ì¹˜ê¸°" />
                  </div>

                  <div class="mat-block-set">
                    <div class="item-grid">
                      {% if market.market_type|lower == 'mart' %}
                        {% for item in matched_ingredients %}
                          <div class="item">
                            {% if item.image %}
                              <img class="item-pic" src="{{ item.image }}" alt="{{ item.name }}" />
                            {% else %}
                              <div class="item-pic no-img-box"></div>
                            {% endif %}
                            {{ item.name }}
                          </div>
                        {% empty %}
                          <p>ì¥ë°”êµ¬ë‹ˆì— ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        {% endfor %}
                      {% elif market.market_type|lower == 'trad' %}
                        {% for item in unmatched_ingredients %}
                          <div class="item">
                            {% if item.image %}
                              <img class="item-pic" src="{{ item.image }}" alt="{{ item.name }}" />
                            {% else %}
                              <div class="item-pic no-img-box"></div>
                            {% endif %}
                            {{ item.name }}
                          </div>
                        {% empty %}
                          <p>ì¥ë°”êµ¬ë‹ˆì— ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        {% endfor %}
                      {% else %}
                        <p>ì¥ë°”êµ¬ë‹ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                      {% endif %}
                    </div>

                    {% if market.market_type|lower == 'mart' and unmatched_ingredients %}
                      <p class="unmatched-note">
                        {% for item in unmatched_ingredients %}
                          <span class="pill">{{ item.name }}</span>
                        {% endfor %}
                        ì€(ëŠ”) í•´ë‹¹ ë§ˆíŠ¸ì—ì„œ íŒë§¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                      </p>
                    {% endif %}
                  </div>
                </div>

              </div>
            </div>
          </div>
        </main>

        <footer class="start">
          <span class="start-point">
            <img src="{% static 'img/coins.svg' %}" alt="coins" /> {{ point_earned }} í¬ì¸íŠ¸ ì ë¦½
          </span>

          {% if closing_in_minutes > 0 %}
            <form method="get" action="{% url 'market:map_direction' %}">
              <input type="hidden" name="market_id" value="{{ market.id }}" />
              <input type="hidden" name="expected_time" value="{{ expected_time }}" />
              <input type="hidden" name="point_earned" value="{{ point_earned }}" />
              <button type="submit" class="startBtn">ì¶œë°œí•˜ê¸°</button>
            </form>
          {% else %}
            <button class="startBtn" disabled aria-disabled="true" title="ì˜ì—… ì¢…ë£Œ">ì¶œë°œí•˜ê¸°</button>
          {% endif %}
        </footer>

        {% if closing_in_minutes <= 0 %}
        <div class="modal open" role="dialog" aria-modal="true" aria-labelledby="closed-title">
          <div class="modal-content">
            <img class="closed" src="{% static 'img/frown.svg' %}" alt="" aria-hidden="true" />
            <p id="closed-title" class="modal-title">í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ìƒì ì´ ì—†ì–´ìš”</p>
            <p class="modal-detail">
              ë‹´ê¸´ ì¬ë£ŒëŠ” ì¥ë°”êµ¬ë‹ˆì— ì €ì¥ë˜ë¯€ë¡œ<br />ë‹¤ìŒì— ì‹œë„í•´ì£¼ì„¸ìš”
            </p>
            <div class="modal-footer">
              <a class="modal-exit" href="{% url 'food:main' %}">í™ˆìœ¼ë¡œ</a>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    <script src="{% static 'js/nearest_market.js' %}" defer></script>
  </body>
</html>
