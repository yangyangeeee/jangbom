<a href="javascript:history.back()">â—</a>
<a href="{% url 'food:cart_view' %}">ğŸ§º
        {% if cart_items_count == 0 %}
        {% else %}
            {{ cart_items_count }}
        {% endif %}
    </a>
    <a href="{% url 'point:barcode' %}">ë°”ì½”ë“œ</a>
    {{ total_point }}P

<h2>ìš”ë¦¬ë²• ë³´ê´€í•¨</h2>

<!-- ê²€ìƒ‰ í¼ -->
<form method="get" action="">
    <input type="hidden" name="sort" value="{{ sort|default:'latest' }}">
    <input type="text" name="q" value="{{ q|default:'' }}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button type="submit">ê²€ìƒ‰</button>
</form>

<!-- ì •ë ¬ í¼ -->
<form method="get" action="">
    <input type="hidden" name="q" value="{{ q|default:'' }}">
    <label>
        <input type="radio" name="sort" value="latest" {% if sort == 'latest' %}checked{% endif %} onchange="this.form.submit()">
        ìµœì‹ ìˆœ
    </label>
    <label>
        <input type="radio" name="sort" value="alpha" {% if sort == 'alpha' %}checked{% endif %} onchange="this.form.submit()">
        ê°€ë‚˜ë‹¤ìˆœ
    </label>
</form>

<hr>

<!-- ë ˆì‹œí”¼ ëª©ë¡ -->
{% if recipes %}
<ul id="recipe-list">
    {% for recipe in recipes %}
        <li>
        <div class="recipe-item" data-id="{{ recipe.id }}" data-title="{{ recipe.title|escape }}">
            <span class="toggle">â–¶</span>
            <span class="title">{{ recipe.title }}</span>
            <small class="created">({{ recipe.created_at|date:"Y-m-d" }})</small>
        </div>
        <div class="recipe-detail" id="recipe-detail-{{ recipe.id }}" style="display:none;"></div>
        </li>
    {% endfor %}
</ul>
{% else %}
<p>ì €ì¥ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".recipe-item").forEach(item => {
        item.addEventListener("click", function() {
        const recipeId = this.getAttribute("data-id");
        const detailDiv = document.getElementById("recipe-detail-" + recipeId);
        const toggleEl = this.querySelector(".toggle");   // â–¶ / â–¼ ë§Œ ë°”ê¿ˆ

        if (detailDiv.style.display === "block") {
            // ë‹«ê¸°
            detailDiv.style.display = "none";
            toggleEl.textContent = "â–¶";
            return;
        }

        // ì²˜ìŒ ì—´ ë•Œë§Œ fetch
        if (!detailDiv.innerHTML.trim()) {
            fetch(`/accounts/recipes/${recipeId}/ajax/`)
            .then(res => res.json())
            .then(data => {
                detailDiv.innerHTML = `
                <p><strong>${data.title}</strong></p>
                <p>ìš”ë¦¬ë²• ì„¤ëª…</p>
                <pre>${data.description}</pre>
                `;
                detailDiv.style.display = "block";
                toggleEl.textContent = "â–¼";
            });
        } else {
            // ì´ë¯¸ ë‚´ìš© ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë³´ì—¬ì£¼ê¸°
            detailDiv.style.display = "block";
            toggleEl.textContent = "â–¼";
        }
        });
    });
});
</script>