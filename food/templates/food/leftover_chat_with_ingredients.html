{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>요리 아이디어</title>
    <link rel="stylesheet" href="{% static 'css/food_leftover_chat_with_ingredients.css' %}" />
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <script src="{% static 'js/food_leftover_chat_with_ingredients.js' %}" defer></script>
  </head>
  <body>
    <div class="container">
      <div class="box">
        <!-- 상단바 -->
        <div class="status-bar">
          <p>19:20</p>
          <div class="status1">
            <img class="status2" src="{% static 'img/reception.svg' %}" alt="reception" />
            <img class="status2" src="{% static 'img/wifi.svg' %}" alt="wifi" />
            <img class="status2" src="{% static 'img/battery.svg' %}" alt="battery" />
          </div>
        </div>

        <!-- 앱 자체 상단바 -->
        <div class="app-top-bar">
          <a class="top-back" href="{% url 'food:recipe_input' %}" aria-label="뒤로가기">
            <img src="{% static 'img/chevron-left(gray).svg' %}" alt="back" />
          </a>
          <div class="top-point">
            <a href="{% url 'food:cart_view' %}" class="basket-container" aria-label="장바구니">
              <img src="{% static 'img/basket.svg' %}" class="basket" alt="basket" />
              <span class="basket-count">{{ cart_items_count|default:0 }}</span>
            </a>
            <a href="{% url 'point:barcode' %}" aria-label="바코드">
              <img class="point" src="{% static 'img/lucide.svg' %}" alt="point" />
            </a>
            <a href="{% url 'point:point_home' %}" aria-label="포인트">
              <p class="mypoint">{{ total_point|default:"0" }} P</p>
            </a>
          </div>
        </div>

        <section class="mainMent">
            <div class="userFood">
            <p>{{ selected_names|join:", " }}로</p>
            <p>이런 요리를 할 수 있어요!</p>
            </div>
        </section>

        <main class="app-body">
          <section id="mainBoard">
            <div class="chatBoard" id="chat">
              {% for m in chat %}
                {% if m.role == "user" %}
                  <div class="userMsg"><p>{{ m.content }}</p></div>
                {% else %}
                  <div class="gptMsg"><p>{{ m.content }}</p></div>
                {% endif %}
              {% endfor %}
            </div>
          </section>

          <form method="get" class="ingredientsGet" action="{% url 'food:save_last_recipe' %}">
            {% csrf_token %}
            <input type="hidden" name="recipe" value="{{ latest_recipe }}">
            <button type="submit" class="foodBtn" id="openModalBtn">
              {% if last_recipe_title %}
                {{ last_recipe_title }} 저장하기
              {% else %}
                요리법 저장하기
              {% endif %}
            </button>
          </form>

          <div id="gptBox" class="gptBox">
            <form method="post" class="inputBar" action="">
              {% csrf_token %}
              <input type="text" name="message" placeholder="요리명을 입력해주세요" class="gptInput" />
              <button type="submit" class="rightArrow" aria-label="전송">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M12 5L19 12M19 12L12 19M19 12H5" stroke="#ACCE58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </form>
          </div>
        </main>
      </div>
    </div>

    <!-- (데모) 키보드 이미지 -->
    <img src="{% static 'img/iOS.png' %}" alt="keyboard" class="keyboard-icon" />

    <!-- 모달 -->
    {% if saved_title %}
    <dialog id="savedRecipeDialog">
      <button value="close" id="backBtn" aria-label="닫기">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
          <path d="M24 8L8 24M8 8L24 24" stroke="#D9D9D9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div class="model-ment">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
          <path d="M29.0681 13.3333C29.6771 16.3217 29.2431 19.4286 27.8386 22.1357C26.4341 24.8429 24.144 26.9867 21.3502 28.2097C18.5563 29.4328 15.4276 29.661 12.4859 28.8565C9.5441 28.0519 6.96705 26.2632 5.1845 23.7885C3.40195 21.3139 2.52163 18.303 2.69035 15.2578C2.85907 12.2127 4.06664 9.31744 6.11167 7.05488C8.1567 4.79232 10.9156 3.29923 13.9282 2.82459C16.9409 2.34995 20.0252 2.92247 22.6668 4.44665M12.0001 14.6667L16.0001 18.6667L29.3335 5.33332" stroke="#ACCE58" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p>요리법 저장 완료</p>
      </div>
      <button type="button" id="confirmBtn" data-href="{% url 'accounts:my_recipes' %}">저장한 요리법 보러 가기</button>
    </dialog>
    {% endif %}
  </body>
</html>
